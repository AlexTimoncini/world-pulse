<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="./manifest.json"/>
    <link rel="apple-touch-icon" sizes="32x32" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="58x58" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="64x64" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="80x80" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="87x87" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="128x128" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="256x256" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="512x512" href="./logos/logo.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="48x48" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="72x72" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="144x144" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./logos/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./logos/logo.png">
    <link rel="stylesheet" href="/style.css">
    <title>Trends - WorldPulse</title>
</head>
<body>
    <header>
        <div class="logo">
            <h1><a href="https://luglawhaulsano.net/4/8605683" target="_blank" onclick="navigateTo('/')">WorldPulse</a></h1>
        </div>
        <nav>
            <ul>
                <li><a href="https://luglawhaulsano.net/4/8605683" target="_blank" onclick="navigateTo('/')">Home</a></li>
                <li><a href="https://luglawhaulsano.net/4/8605683" target="_blank" onclick="navigateTo('/articles.html')">News</a></li>
                <li><a href="https://luglawhaulsano.net/4/8605683" target="_blank" onclick="navigateTo('/trends.html')">Trends</a></li>
                <li><a href="https://luglawhaulsano.net/4/8605683" target="_blank" onclick="navigateTo('/about-us.html')">About us</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <a href="https://www.tradingview.com/chart/?aff_id=147155&utm_source=creative&utm_lang=EN" target="_blank">
            <img style="
			background-image: url(https://s3.tradingview.com/pub/referrals/creatives/WT/EN/468x60Banner.jpg);
			@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
			    background-image: url(https://s3.tradingview.com/pub/referrals/creatives/WT/EN/936x120Banner.jpg);
			}
		" width="468" height="60" border="0" />
        </a>

        <section class="article-list">
            <h2>
                Trends
            </h2>
            <section class="articles"></section>
            <div id="paginator"></div>
        </section>
        <a href="https://www.tradingview.com/chart/?aff_id=147155&utm_source=creative&utm_lang=EN" target="_blank">
            <img style="
			background-image: url(https://s3.tradingview.com/pub/referrals/creatives/WT/EN/468x60Banner.jpg);
			@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
			    background-image: url(https://s3.tradingview.com/pub/referrals/creatives/WT/EN/936x120Banner.jpg);
			}
		" width="468" height="60" border="0" />
        </a>

    </main>
    <footer>
        <p>&copy; 2024 WorldPulse.it - All rights reserved.</p>
    </footer>
<script src="./script.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", async function(){
        let articles = await getArticles()
        let params = new URLSearchParams(document.location.search);
        let page = parseInt(params.get("page") ?? 1)
        buildNavigator(page, articles.length)
        let offset = (page-1)*12
        console.log(offset, (articles.length - offset > 12 ? 12 : articles.length - offset))
        articles = articles.slice(offset, (articles.length - offset > 12 ? offset+12 : articles.length))
        articles.forEach((a) => {
            let section = document.querySelector(".articles")
            let article = `
                <div class="article" id="article_${a.id}">
                    <img src="/images/${a.image}" alt="${a.title}">
                    <h3>${a.title}</h3>
                    <p>${a.description}</p>
                    <a href="https://luglawhaulsano.net/4/8605683" target="_blank" id="link${a.id}" onclick="navigateTo('/articles/${a.url}')">Read the article</a>
                </div>`
            section.insertAdjacentHTML("beforeend", article)
        })
        function buildNavigator(activePage, articles){
            let pages = Math.ceil(articles / 12),
                paginator = document.getElementById("paginator"),
                btns = ``
            console.log(activePage, articles, pages)
            if(pages > 1) {
                if(activePage === pages){
                    btns = `<a href="" onclick="navigateTo('/trends.html?page=${pages-1}')">Page ${pages-1}</a>`
                } else if(activePage === 1){
                    btns = `<a href="" onclick="navigateTo('/trends.html?page=2')">Page 2</a>`
                } else {
                    btns = `<a href="" onclick="navigateTo('/trends.html?page=${activePage-1}')">Page ${activePage-1}</a>
                            <a href="" onclick="navigateTo('/trends.html?page=${activePage+1}')">Page ${activePage+1}</a>`
                }
            }
            paginator.innerHTML = btns
        }
        async function getArticles() {
            try {
                const response = await fetch('/articles/articles.json');
                if (!response.ok) {
                    throw new Error('Failed to load level manifest');
                }
                const manifest = await response.json()
                return manifest.articles.sort((a,b)=>b.id - a.id)
            } catch (error) {
                return false
            }
        }
    })
</script>
</body>
</html>